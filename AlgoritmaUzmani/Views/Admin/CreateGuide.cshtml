@model AlgoritmaUzmani.Models.ViewModels.Admin.GuideViewModel
@{
    ViewData["Title"] = "Yeni Rehber";
    Layout = "_AdminLayout";
}

<form asp-action="CreateGuide" method="post" enctype="multipart/form-data" id="guideForm">
    @Html.AntiForgeryToken()

    <div style="display: grid; grid-template-columns: 1fr 350px; gap: 1.5rem;">
        <!-- Main Content -->
        <div>
            <div class="card mb-3">
                <div class="card-header">
                    <h2 class="card-title">Ä°Ã§erik</h2>
                </div>
                <div class="card-body">
                    <!-- Tabs -->
                    <div class="tabs">
                        <div class="tab active" data-tab="tr">ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</div>
                        <div class="tab" data-tab="en">ðŸ‡¬ðŸ‡§ Ä°ngilizce</div>
                    </div>

                    <!-- Turkish Content -->
                    <div class="tab-content active" id="tab-tr">
                        <div class="form-group">
                            <label asp-for="TitleTr" class="form-label">BaÅŸlÄ±k (TR) *</label>
                            <input asp-for="TitleTr" class="form-control" placeholder="Rehber baÅŸlÄ±ÄŸÄ±" />
                            <span asp-validation-for="TitleTr" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="SummaryTr" class="form-label">Ã–zet (TR)</label>
                            <textarea asp-for="SummaryTr" class="form-control" rows="2" 
                                      placeholder="KÄ±sa Ã¶zet (liste gÃ¶rÃ¼nÃ¼mÃ¼nde gÃ¶sterilir)"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ä°Ã§erik (TR) *</label>
                            <div class="editor-toolbar">
                                <button type="button" class="editor-btn" onclick="execCmd('bold')" title="KalÄ±n"><i class="fas fa-bold"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmd('italic')" title="Ä°talik"><i class="fas fa-italic"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmd('underline')" title="AltÄ± Ã‡izili"><i class="fas fa-underline"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmd('strikeThrough')" title="ÃœstÃ¼ Ã‡izili"><i class="fas fa-strikethrough"></i></button>
                                <span style="width: 1px; height: 24px; background: var(--border); margin: 0 0.25rem;"></span>
                                <button type="button" class="editor-btn" onclick="execCmd('formatBlock', 'h2')" title="BaÅŸlÄ±k 2">H2</button>
                                <button type="button" class="editor-btn" onclick="execCmd('formatBlock', 'h3')" title="BaÅŸlÄ±k 3">H3</button>
                                <button type="button" class="editor-btn" onclick="execCmd('formatBlock', 'h4')" title="BaÅŸlÄ±k 4">H4</button>
                                <button type="button" class="editor-btn" onclick="execCmd('formatBlock', 'p')" title="Paragraf">P</button>
                                <span style="width: 1px; height: 24px; background: var(--border); margin: 0 0.25rem;"></span>
                                <button type="button" class="editor-btn" onclick="execCmd('insertUnorderedList')" title="Liste"><i class="fas fa-list-ul"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmd('insertOrderedList')" title="NumaralÄ± Liste"><i class="fas fa-list-ol"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmd('formatBlock', 'blockquote')" title="AlÄ±ntÄ±"><i class="fas fa-quote-left"></i></button>
                                <button type="button" class="editor-btn" onclick="openCodeEditor()" title="Kod BloÄŸu (GeliÅŸmiÅŸ)"><i class="fas fa-code"></i></button>
                                <span style="width: 1px; height: 24px; background: var(--border); margin: 0 0.25rem;"></span>
                                <button type="button" class="editor-btn" onclick="insertLink()" title="Link"><i class="fas fa-link"></i></button>
                                <button type="button" class="editor-btn" onclick="insertImage()" title="Resim"><i class="fas fa-image"></i></button>
                                <span style="width: 1px; height: 24px; background: var(--border); margin: 0 0.25rem;"></span>
                                <button type="button" class="editor-btn" onclick="execCmd('justifyLeft')" title="Sola Hizala"><i class="fas fa-align-left"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmd('justifyCenter')" title="Ortala"><i class="fas fa-align-center"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmd('justifyRight')" title="SaÄŸa Hizala"><i class="fas fa-align-right"></i></button>
                            </div>
                            <div class="editor-content" contenteditable="true" id="editorTr" 
                                 style="min-height: 400px;" data-target="ContentTr"></div>
                            <input type="hidden" asp-for="ContentTr" id="ContentTr" />
                            <span asp-validation-for="ContentTr" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- English Content -->
                    <div class="tab-content" id="tab-en">
                        <div class="form-group">
                            <label asp-for="TitleEn" class="form-label">BaÅŸlÄ±k (EN)</label>
                            <input asp-for="TitleEn" class="form-control" placeholder="Guide title" />
                        </div>

                        <div class="form-group">
                            <label asp-for="SummaryEn" class="form-label">Ã–zet (EN)</label>
                            <textarea asp-for="SummaryEn" class="form-control" rows="2" 
                                      placeholder="Short summary"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ä°Ã§erik (EN)</label>
                            <div class="editor-toolbar">
                                <button type="button" class="editor-btn" onclick="execCmdEn('bold')" title="Bold"><i class="fas fa-bold"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmdEn('italic')" title="Italic"><i class="fas fa-italic"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmdEn('underline')" title="Underline"><i class="fas fa-underline"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmdEn('formatBlock', 'h2')" title="Heading 2">H2</button>
                                <button type="button" class="editor-btn" onclick="execCmdEn('formatBlock', 'h3')" title="Heading 3">H3</button>
                                <button type="button" class="editor-btn" onclick="execCmdEn('formatBlock', 'p')" title="Paragraph">P</button>
                                <button type="button" class="editor-btn" onclick="execCmdEn('insertUnorderedList')" title="List"><i class="fas fa-list-ul"></i></button>
                                <button type="button" class="editor-btn" onclick="execCmdEn('insertOrderedList')" title="Numbered List"><i class="fas fa-list-ol"></i></button>
                                <button type="button" class="editor-btn" onclick="insertLinkEn()" title="Link"><i class="fas fa-link"></i></button>
                                <button type="button" class="editor-btn" onclick="insertImageEn()" title="Image"><i class="fas fa-image"></i></button>
                            </div>
                            <div class="editor-content" contenteditable="true" id="editorEn" 
                                 style="min-height: 400px;" data-target="ContentEn"></div>
                            <input type="hidden" asp-for="ContentEn" id="ContentEn" />
                        </div>

                        <div class="alert alert-success" style="margin-top: 1rem;">
                            <i class="fas fa-info-circle"></i>
                            Ä°ngilizce iÃ§erik iÃ§in kayÄ±t sonrasÄ± "Ã‡evir" butonunu kullanabilirsiniz.
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEO -->
            <div class="card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="card-title">SEO AyarlarÄ±</h2>
                    <button type="button" class="btn btn-secondary" id="btnSeoSuggestion" onclick="getSeoSuggestions()" style="font-size: 0.85rem; padding: 0.4rem 0.75rem;">
                        <i class="fas fa-magic"></i> AI ile Ã–ner
                    </button>
                </div>
                <div class="card-body">
                    <div id="seoLoading" style="display: none; text-align: center; padding: 1rem; background: #f1f5f9; border-radius: 0.5rem; margin-bottom: 1rem;">
                        <i class="fas fa-spinner fa-spin"></i> SEO Ã¶nerileri oluÅŸturuluyor...
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="MetaDescriptionTr" class="form-label">Meta AÃ§Ä±klama (TR)</label>
                            <textarea asp-for="MetaDescriptionTr" class="form-control" rows="2" maxlength="160"
                                      placeholder="Google aramalarÄ±nda gÃ¶rÃ¼necek aÃ§Ä±klama (max 160 karakter)"></textarea>
                            <div class="form-hint">Kalan: <span id="metaTrCount">160</span> karakter</div>
                        </div>
                        <div class="form-group">
                            <label asp-for="MetaDescriptionEn" class="form-label">Meta AÃ§Ä±klama (EN)</label>
                            <textarea asp-for="MetaDescriptionEn" class="form-control" rows="2" maxlength="160"
                                      placeholder="Description for Google search (max 160 chars)"></textarea>
                            <div class="form-hint">Remaining: <span id="metaEnCount">160</span> characters</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="SeoKeywordsTr" class="form-label">SEO Anahtar Kelimeler (TR)</label>
                            <input asp-for="SeoKeywordsTr" class="form-control" 
                                   placeholder="kelime1, kelime2, kelime3" />
                        </div>
                        <div class="form-group">
                            <label asp-for="SeoKeywordsEn" class="form-label">SEO Anahtar Kelimeler (EN)</label>
                            <input asp-for="SeoKeywordsEn" class="form-control" 
                                   placeholder="keyword1, keyword2, keyword3" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div>
            <!-- Publish -->
            <div class="card mb-3">
                <div class="card-header">
                    <h2 class="card-title">YayÄ±nla</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label asp-for="CategoryId" class="form-label">Kategori *</label>
                        <select asp-for="CategoryId" asp-items="Model.Categories" class="form-control">
                            <option value="">-- SeÃ§in --</option>
                        </select>
                        <span asp-validation-for="CategoryId" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <div class="form-check">
                            <input asp-for="IsActive" type="checkbox" />
                            <label asp-for="IsActive">Aktif (YayÄ±nla)</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-check">
                            <input asp-for="IsFeatured" type="checkbox" />
                            <label asp-for="IsFeatured">Ã–ne Ã‡Ä±kan</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label asp-for="DisplayOrder" class="form-label">SÄ±ralama</label>
                        <input asp-for="DisplayOrder" type="number" class="form-control" value="0" />
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i>
                        Kaydet
                    </button>
                </div>
            </div>

            <!-- Image -->
            <div class="card mb-3">
                <div class="card-header">
                    <h2 class="card-title">Ã–ne Ã‡Ä±kan GÃ¶rsel</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <input type="file" name="featuredImage" id="featuredImage" class="form-control" accept="image/*" />
                        <div class="form-hint">Max 10MB (jpg, png, gif, webp)</div>
                    </div>
                    <div id="imagePreview" style="margin-top: 0.5rem;"></div>

                    <div class="form-group mt-2">
                        <label asp-for="FeaturedImageAltTr" class="form-label">Alt YazÄ± (TR)</label>
                        <input asp-for="FeaturedImageAltTr" class="form-control" placeholder="GÃ¶rsel aÃ§Ä±klamasÄ±" />
                    </div>

                    <div class="form-group">
                        <label asp-for="FeaturedImageAltEn" class="form-label">Alt YazÄ± (EN)</label>
                        <input asp-for="FeaturedImageAltEn" class="form-control" placeholder="Image description" />
                    </div>
                </div>
            </div>

            <!-- Tags -->
            <div class="card mb-3">
                <div class="card-header">
                    <h2 class="card-title">Etiketler</h2>
                </div>
                <div class="card-body">
                    <div class="form-group mb-0">
                        <label class="form-label">Ana Etiketler</label>
                        <select asp-for="SelectedTagIds" asp-items="Model.Tags" class="form-control" multiple>
                        </select>
                        <div class="form-hint">Ctrl+Click ile Ã§oklu seÃ§im</div>
                    </div>
                </div>
            </div>

            <!-- SEO Tags -->
            <div class="card mb-3">
                <div class="card-header">
                    <h2 class="card-title">SEO Etiketleri</h2>
                </div>
                <div class="card-body">
                    <div class="form-group mb-0">
                        <select asp-for="SelectedSeoTagIds" asp-items="Model.SeoTags" class="form-control" multiple>
                        </select>
                        <div class="form-hint">Google botlarÄ± iÃ§in gizli etiketler</div>
                    </div>
                </div>
            </div>

            <!-- Related Guides -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Ä°lgili Rehberler</h2>
                </div>
                <div class="card-body">
                    <div class="form-group mb-0">
                        <select asp-for="RelatedGuideIds" asp-items="Model.AllGuides" class="form-control" multiple>
                        </select>
                        <div class="form-hint">Sayfada gÃ¶sterilecek ilgili rehberler</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Image Upload Modal -->
<div class="modal-overlay" id="imageModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Resim Ekle</h3>
            <button type="button" class="modal-close" onclick="closeImageModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="tabs" style="margin-bottom: 1rem;">
                <div class="tab active" data-modal-tab="upload">YÃ¼kle</div>
                <div class="tab" data-modal-tab="url">URL</div>
            </div>
            
            <div id="modal-upload" class="tab-content active">
                <div class="form-group">
                    <label class="form-label">Resim SeÃ§</label>
                    <input type="file" id="modalImageFile" class="form-control" accept="image/*" />
                </div>
            </div>
            
            <div id="modal-url" class="tab-content">
                <div class="form-group">
                    <label class="form-label">Resim URL</label>
                    <input type="text" id="modalImageUrl" class="form-control" placeholder="https://..." />
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Hizalama</label>
                <select id="imageAlign" class="form-control">
                    <option value="">VarsayÄ±lan</option>
                    <option value="left">Sol</option>
                    <option value="center">Orta</option>
                    <option value="right">SaÄŸ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">GeniÅŸlik (px veya %)</label>
                <input type="text" id="imageWidth" class="form-control" placeholder="Ã–rn: 500 veya 100%" />
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeImageModal()">Ä°ptal</button>
            <button type="button" class="btn btn-primary" onclick="confirmInsertImage()">Ekle</button>
        </div>
    </div>
</div>

<!-- Code Editor Modal -->
<div class="modal-overlay" id="codeModal">
    <div class="modal" style="max-width: 900px;">
        <div class="modal-header">
            <h3 class="modal-title">Kod BloÄŸu Ekle</h3>
            <button type="button" class="modal-close" onclick="closeCodeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Programlama Dili</label>
                <select id="codeLanguage" class="form-control">
                    <option value="javascript">JavaScript</option>
                    <option value="python">Python</option>
                    <option value="java">Java</option>
                    <option value="csharp">C#</option>
                    <option value="cpp">C++</option>
                    <option value="c">C</option>
                    <option value="go">Go</option>
                    <option value="rust">Rust</option>
                    <option value="php">PHP</option>
                    <option value="ruby">Ruby</option>
                    <option value="swift">Swift</option>
                    <option value="kotlin">Kotlin</option>
                    <option value="typescript">TypeScript</option>
                    <option value="sql">SQL</option>
                    <option value="html">HTML</option>
                    <option value="css">CSS</option>
                    <option value="bash">Bash</option>
                    <option value="json">JSON</option>
                    <option value="yaml">YAML</option>
                    <option value="xml">XML</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Kodunuz</label>
                <textarea id="codeInput" class="form-control" rows="15" 
                    placeholder="// Kodunuzu buraya yazÄ±n..." 
                    style="font-family: 'Consolas', 'Monaco', monospace; font-size: 14px;"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="enableMultiLang" style="margin-right: 0.5rem;">
                    Ã‡oklu Dil DesteÄŸi (Deep Infra ile Ã§eviri)
                </label>
            </div>

            <div id="multiLangOptions" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Ã‡evrilecek Diller (Ctrl+Click ile Ã§oklu seÃ§im)</label>
                    <select id="targetLanguages" class="form-control" multiple style="min-height: 120px;">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="csharp">C#</option>
                        <option value="cpp">C++</option>
                        <option value="go">Go</option>
                        <option value="rust">Rust</option>
                        <option value="php">PHP</option>
                        <option value="ruby">Ruby</option>
                        <option value="swift">Swift</option>
                        <option value="kotlin">Kotlin</option>
                        <option value="typescript">TypeScript</option>
                    </select>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="translateCode()" id="btnTranslateCode">
                    <i class="fas fa-language"></i> Kodu Ã‡evir
                </button>
                
                <div id="translationProgress" style="display: none; margin-top: 1rem; padding: 1rem; background: #f1f5f9; border-radius: 0.5rem;">
                    <i class="fas fa-spinner fa-spin"></i> Kodlar Ã§evriliyor, lÃ¼tfen bekleyin...
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeCodeModal()">Ä°ptal</button>
            <button type="button" class="btn btn-primary" onclick="insertCodeBlock()">
                <i class="fas fa-plus"></i> Ekle
            </button>
        </div>
    </div>
</div>

@section Scripts {
<!-- Prism.js for Code Highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ruby.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-swift.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-kotlin.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>

<script>
    // Tabs
    document.querySelectorAll('.tab[data-tab]').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            document.querySelectorAll('.tab[data-tab]').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        });
    });

    // Modal Tabs
    document.querySelectorAll('.tab[data-modal-tab]').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.getAttribute('data-modal-tab');
            document.querySelectorAll('.tab[data-modal-tab]').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#imageModal .tab-content').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('modal-' + tabId).classList.add('active');
        });
    });

    // Editor Commands
    function execCmd(command, value = null) {
        document.getElementById('editorTr').focus();
        document.execCommand(command, false, value);
    }

    function execCmdEn(command, value = null) {
        document.getElementById('editorEn').focus();
        document.execCommand(command, false, value);
    }

    // Code Editor Variables
    let currentCodeTranslations = {};
    let currentCodeLanguage = 'javascript';

    // Open Code Editor Modal
    function openCodeEditor() {
        currentEditor = 'tr';
        currentCodeTranslations = {};
        document.getElementById('codeInput').value = '';
        document.getElementById('codeLanguage').value = 'javascript';
        document.getElementById('enableMultiLang').checked = false;
        document.getElementById('multiLangOptions').style.display = 'none';
        document.getElementById('codeModal').classList.add('active');
    }

    // Close Code Editor Modal
    function closeCodeModal() {
        document.getElementById('codeModal').classList.remove('active');
    }

    // Toggle Multi-Language Options
    document.addEventListener('DOMContentLoaded', function() {
        const enableMultiLang = document.getElementById('enableMultiLang');
        if (enableMultiLang) {
            enableMultiLang.addEventListener('change', function() {
                document.getElementById('multiLangOptions').style.display = 
                    this.checked ? 'block' : 'none';
            });
        }
    });

    // Translate Code using Deep Infra
    async function translateCode() {
        const sourceCode = document.getElementById('codeInput').value;
        const sourceLang = document.getElementById('codeLanguage').value;
        const targetLangs = Array.from(document.getElementById('targetLanguages').selectedOptions)
            .map(opt => opt.value);

        if (!sourceCode.trim()) {
            alert('LÃ¼tfen Ã¶nce bir kod yazÄ±n');
            return;
        }

        if (targetLangs.length === 0) {
            alert('LÃ¼tfen en az bir hedef dil seÃ§in');
            return;
        }

        const btn = document.getElementById('btnTranslateCode');
        const progress = document.getElementById('translationProgress');

        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ã‡evriliyor...';
        progress.style.display = 'block';

        try {
            const response = await fetch('/admin/translate-code', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    sourceCode: sourceCode,
                    sourceLanguage: sourceLang,
                    targetLanguages: targetLangs
                })
            });

            const result = await response.json();

            if (result.success) {
                currentCodeTranslations = result.translations;
                currentCodeLanguage = sourceLang;
                alert('Kod Ã§evirileri baÅŸarÄ±yla oluÅŸturuldu! Åžimdi "Ekle" butonuna tÄ±klayÄ±n.');
            } else {
                alert('Hata: ' + result.error);
            }
        } catch (e) {
            alert('Bir hata oluÅŸtu: ' + e.message);
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-language"></i> Kodu Ã‡evir';
            progress.style.display = 'none';
        }
    }

    // Insert Code Block into Editor
    function insertCodeBlock() {
        const code = document.getElementById('codeInput').value;
        const lang = document.getElementById('codeLanguage').value;
        const enableMulti = document.getElementById('enableMultiLang').checked;

        if (!code.trim()) {
            alert('LÃ¼tfen kod yazÄ±n');
            return;
        }

        let html = '';

        if (enableMulti && Object.keys(currentCodeTranslations).length > 0) {
            // Multi-language code block with tabs
            const codeId = 'code-' + Date.now();
            html = '<div class="code-block-multilang" data-code-id="' + codeId + '" style="margin: 1.5rem 0; border: 1px solid #e2e8f0; border-radius: 0.5rem; overflow: hidden;">';
            
            // Language tabs
            html += '<div class="code-tabs" style="display: flex; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">';
            let first = true;
            for (const [language, translation] of Object.entries(currentCodeTranslations)) {
                const displayName = getLanguageDisplayName(language);
                html += '<button type="button" class="code-tab ' + (first ? 'active' : '') + '" ';
                html += 'data-lang="' + language + '" ';
                html += 'onclick="switchCodeTab(\'' + codeId + '\', \'' + language + '\')" ';
                html += 'style="padding: 0.75rem 1.25rem; border: none; background: ' + (first ? '#fff' : 'transparent') + '; ';
                html += 'cursor: pointer; font-weight: 500; color: ' + (first ? '#2563eb' : '#64748b') + ';">';
                html += displayName + '</button>';
                first = false;
            }
            html += '</div>';

            // Code contents
            first = true;
            for (const [language, translation] of Object.entries(currentCodeTranslations)) {
                html += '<div class="code-content" data-lang="' + language + '" ';
                html += 'style="display: ' + (first ? 'block' : 'none') + ';">';
                html += '<pre style="margin: 0;"><code class="language-' + language + '">';
                html += escapeHtml(translation);
                html += '</code></pre></div>';
                first = false;
            }

            html += '</div><p></p>';
        } else {
            // Single language code block
            html = '<pre><code class="language-' + lang + '">';
            html += escapeHtml(code);
            html += '</code></pre><p></p>';
        }

        const editor = currentEditor === 'tr' ? 
            document.getElementById('editorTr') : 
            document.getElementById('editorEn');
        
        editor.focus();
        document.execCommand('insertHTML', false, html);

        // Highlight the code
        setTimeout(() => {
            Prism.highlightAll();
        }, 100);

        closeCodeModal();
    }

    // Switch Code Tab
    function switchCodeTab(codeId, language) {
        const container = document.querySelector('[data-code-id="' + codeId + '"]');
        if (!container) return;

        // Update tabs
        container.querySelectorAll('.code-tab').forEach(tab => {
            const isActive = tab.getAttribute('data-lang') === language;
            tab.classList.toggle('active', isActive);
            tab.style.background = isActive ? '#fff' : 'transparent';
            tab.style.color = isActive ? '#2563eb' : '#64748b';
        });

        // Update content
        container.querySelectorAll('.code-content').forEach(content => {
            content.style.display = 
                content.getAttribute('data-lang') === language ? 'block' : 'none';
        });
    }

    // Get Language Display Name
    function getLanguageDisplayName(lang) {
        const names = {
            'javascript': 'JavaScript',
            'python': 'Python',
            'java': 'Java',
            'csharp': 'C#',
            'cpp': 'C++',
            'c': 'C',
            'go': 'Go',
            'rust': 'Rust',
            'php': 'PHP',
            'ruby': 'Ruby',
            'swift': 'Swift',
            'kotlin': 'Kotlin',
            'typescript': 'TypeScript',
            'sql': 'SQL',
            'html': 'HTML',
            'css': 'CSS',
            'bash': 'Bash',
            'json': 'JSON',
            'yaml': 'YAML'
        };
        return names[lang] || lang.toUpperCase();
    }

    // Escape HTML
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function insertLink() {
        const url = prompt('Link URL:', 'https://');
        if (url) {
            execCmd('createLink', url);
        }
    }

    function insertLinkEn() {
        const url = prompt('Link URL:', 'https://');
        if (url) {
            document.getElementById('editorEn').focus();
            document.execCommand('createLink', false, url);
        }
    }

    let currentEditor = 'tr';
    
    function insertImage() {
        currentEditor = 'tr';
        document.getElementById('imageModal').classList.add('active');
    }

    function insertImageEn() {
        currentEditor = 'en';
        document.getElementById('imageModal').classList.add('active');
    }

    function closeImageModal() {
        document.getElementById('imageModal').classList.remove('active');
        document.getElementById('modalImageFile').value = '';
        document.getElementById('modalImageUrl').value = '';
        document.getElementById('imageWidth').value = '';
        document.getElementById('imageAlign').value = '';
    }

    async function confirmInsertImage() {
        const file = document.getElementById('modalImageFile').files[0];
        const url = document.getElementById('modalImageUrl').value;
        const width = document.getElementById('imageWidth').value;
        const align = document.getElementById('imageAlign').value;
        
        let imgUrl = url;
        
        if (file) {
            // Upload file
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/admin/upload-image', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                if (result.success) {
                    imgUrl = result.url;
                } else {
                    alert('YÃ¼kleme hatasÄ±: ' + result.error);
                    return;
                }
            } catch (e) {
                alert('YÃ¼kleme hatasÄ±: ' + e.message);
                return;
            }
        }
        
        if (!imgUrl) {
            alert('LÃ¼tfen bir resim seÃ§in veya URL girin');
            return;
        }
        
        let style = '';
        if (width) style += 'width:' + width + ';';
        if (align === 'center') style += 'display:block;margin:0 auto;';
        else if (align === 'left') style += 'float:left;margin-right:1rem;';
        else if (align === 'right') style += 'float:right;margin-left:1rem;';
        
        const img = '<img src="' + imgUrl + '"' + (style ? ' style="' + style + '"' : '') + ' />';
        
        const editor = currentEditor === 'tr' ? document.getElementById('editorTr') : document.getElementById('editorEn');
        editor.focus();
        document.execCommand('insertHTML', false, img);
        
        closeImageModal();
    }

    // Featured Image Preview
    document.getElementById('featuredImage').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').innerHTML = 
                    '<img src="' + e.target.result + '" style="max-width:100%;border-radius:0.5rem;" />';
            };
            reader.readAsDataURL(file);
        }
    });

    // Meta description counter
    document.getElementById('MetaDescriptionTr').addEventListener('input', function() {
        document.getElementById('metaTrCount').textContent = 160 - this.value.length;
    });
    document.getElementById('MetaDescriptionEn').addEventListener('input', function() {
        document.getElementById('metaEnCount').textContent = 160 - this.value.length;
    });

    // Form submit - copy editor content
    document.getElementById('guideForm').addEventListener('submit', function(e) {
        document.getElementById('ContentTr').value = document.getElementById('editorTr').innerHTML;
        document.getElementById('ContentEn').value = document.getElementById('editorEn').innerHTML;
    });

    // Load existing content
    window.addEventListener('load', function() {
        const contentTr = document.getElementById('ContentTr').value;
        const contentEn = document.getElementById('ContentEn').value;
        if (contentTr) document.getElementById('editorTr').innerHTML = contentTr;
        if (contentEn) document.getElementById('editorEn').innerHTML = contentEn;
    });

    // SEO Suggestions
    async function getSeoSuggestions() {
        const title = document.getElementById('TitleTr').value;
        const content = document.getElementById('editorTr').innerHTML;
        
        if (!title && !content) {
            alert('LÃ¼tfen Ã¶nce baÅŸlÄ±k veya iÃ§erik girin');
            return;
        }
        
        const btn = document.getElementById('btnSeoSuggestion');
        const loading = document.getElementById('seoLoading');
        
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Bekleniyor...';
        loading.style.display = 'block';
        
        try {
            const response = await fetch('/admin/guides/seo-suggestions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ title, content })
            });
            
            const result = await response.json();
            
            if (result.success) {
                if (result.metaDescription) {
                    document.getElementById('MetaDescriptionTr').value = result.metaDescription;
                    document.getElementById('metaTrCount').textContent = 160 - result.metaDescription.length;
                }
                if (result.keywords) {
                    document.getElementById('SeoKeywordsTr').value = result.keywords;
                }
                alert('SEO Ã¶nerileri baÅŸarÄ±yla eklendi! Ä°sterseniz dÃ¼zenleyebilirsiniz.');
            } else {
                alert('Hata: ' + result.error);
            }
        } catch (e) {
            alert('Bir hata oluÅŸtu: ' + e.message);
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-magic"></i> AI ile Ã–ner';
            loading.style.display = 'none';
        }
    }
</script>
}

